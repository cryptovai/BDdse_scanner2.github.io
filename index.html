<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE Stock Screener - বাংলাদেশ স্টক মার্কেট বিশ্লেষণ by Adnan Sayem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th {
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }
        th:hover {
            background-color: #f1f5f9;
        }
        .sort-asc::after {
            content: " ↑";
        }
        .sort-desc::after {
            content: " ↓";
        }
        .bangla-text {
            font-family: 'Helvetica', 'Arial', sans-serif;
        }
        .sector-btn {
            transition: all 0.2s;
        }
        .sector-btn:hover {
            transform: translateY(-1px);
        }
        .sector-btn.active {
            background-color: #1d4ed8;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen">
    <header class="bg-blue-800 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <button onclick="fetchStockData()" class="flex items-center bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Refresh
                </button>
                <h1 class="text-xl font-bold">DSE Stock Screener</h1>
            </div>
            <div>
                <p class="text-blue-200 text-sm">বাংলাদেশ স্টক মার্কেট বিশ্লেষণ By Adnan Sayem</p>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- Lightweight Loading Placeholder -->
        <div id="loadingPlaceholder" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
            <p class="mt-2 text-gray-500">প্রাথমিক ডেটা লোড হচ্ছে...</p>
        </div>

        <!-- Sector Filter -->
        <div id="sectorFilter" class="hidden mb-4">
            <div class="flex flex-wrap gap-2">
                <button onclick="filterBySector('all')" class="sector-btn active bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                    সব সেক্টর
                </button>
                <!-- Filled by JavaScript -->
            </div>
        </div>

        <!-- Main Table View -->
        <div id="tableView" class="mb-8 hidden">
            <div class="card overflow-hidden mb-4">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('ticker')">Ticker</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('category')">Category</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('currentPrice')">Price (BDT)</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('faceValue')">Face Value</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('marketCap')">Market Cap (Cr.)</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" onclick="sortTable('peRatio')">P/E</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider bg-blue-100" onclick="sortTable('totalScore')">Score</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Chart</th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Filled by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Detailed Stock View -->
        <div id="detailView" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <button onclick="showTableView()" class="flex items-center text-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    সব স্টকে ফিরে যান
                </button>
                <h2 id="detailStockName" class="text-xl font-bold text-gray-800"></h2>
                <div class="w-5"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Key Metrics Card -->
                <div class="card p-4">
                    <h3 class="font-medium text-gray-700 mb-3">মূল মেট্রিক্স</h3>
                    <div class="space-y-2" id="keyMetrics">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>

                <!-- Growth Metrics Card -->
                <div class="card p-4">
                    <h3 class="font-medium text-gray-700 mb-3">গ্রোথ মেট্রিক্স</h3>
                    <div class="space-y-2" id="growthMetrics">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>

                <!-- Valuation Card -->
                <div class="card p-4">
                    <h3 class="font-medium text-gray-700 mb-3">ভ্যালুয়েশন</h3>
                    <div class="space-y-2" id="valuationMetrics">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Investor Information -->
            <div class="card p-4 mb-6">
                <h3 class="font-medium text-gray-700 mb-3">বিনিয়োগকারীদের জন্য গুরুত্বপূর্ণ তথ্য</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-medium text-gray-600 mb-2">মৌলিক বিশ্লেষণ</h4>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>কোম্পানির আর্থিক অবস্থা পর্যালোচনা করুন</li>
                            <li>ম্যানেজমেন্টের দক্ষতা মূল্যায়ন করুন</li>
                            <li>শিল্পের প্রবৃদ্ধি সম্ভাবনা বিশ্লেষণ করুন</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-600 mb-2">ঝুঁকি ব্যবস্থাপনা</h4>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>বিনিয়োগের আগে ঝুঁকি সহনশীলতা নির্ধারণ করুন</li>
                            <li>বিভিন্ন সেক্টরে বিনিয়োগ ছড়িয়ে দিন</li>
                            <li>স্টপ লস ব্যবহার করুন</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- TradingView Link -->
            <div class="card p-4 mb-6">
                <h3 class="font-medium text-gray-700 mb-3">রিয়েল-টাইম চার্ট বিশ্লেষণ</h3>
                <p class="text-gray-700 mb-3">এই স্টকটির বর্তমান মূল্য প্রবণতা বিশ্লেষণ করতে TradingView-এ দেখুন:</p>
                <a id="tradingviewLink" href="#" target="_blank" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                    TradingView চার্ট দেখুন →
                </a>
            </div>

            <!-- Analysis Summary -->
            <div class="card p-4 mb-6">
                <h3 class="font-medium text-gray-700 mb-3">বিশ্লেষণ ও সুপারিশ</h3>
                <div id="analysisSummary" class="text-gray-700 bangla-text">
                    <!-- Filled by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-blue-800 text-white py-4 mt-8">
        <div class="container mx-auto px-4 text-center text-sm">
            <p>এডনান সায়েমের স্টক বিশ্লেষণ &copy; ২০২৩ | সর্বশেষ আপডেট: <span id="updateTime"></span></p>
        </div>
    </footer>

    <script>
        // Global variables
        let allStocks = [];
        let filteredStocks = [];
        let currentSort = { key: 'totalScore', order: 'desc' };
        let currentStock = null;
        let currentSector = 'all';

        // Initialize the application with lightweight first load
        document.addEventListener('DOMContentLoaded', function() {
            // Show loading placeholder immediately
            document.getElementById('loadingPlaceholder').classList.remove('hidden');
            
            // Load minimal data first
            setTimeout(() => {
                fetchStockData();
            }, 100);
        });

        // Fetch stock data (optimized)
        async function fetchStockData() {
            try {
                // Show loading state
                document.getElementById('loadingPlaceholder').classList.remove('hidden');
                document.getElementById('tableView').classList.add('hidden');
                document.getElementById('detailView').classList.add('hidden');
                
                // Simulated fast data load (replace with actual API call)
                allStocks = generateSimulatedData();
                
                // Initialize sector filter
                initSectorFilter();
                
                // Filter and render table
                filterBySector(currentSector);
                updateLastUpdatedTime();
                
                // Hide loading and show table
                document.getElementById('loadingPlaceholder').classList.add('hidden');
                document.getElementById('tableView').classList.remove('hidden');
                document.getElementById('sectorFilter').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error fetching stock data:', error);
                document.getElementById('loadingPlaceholder').innerHTML = `
                    <p class="text-red-500">ডেটা লোড করতে সমস্যা হয়েছে। Refresh বাটনে ক্লিক করুন।</p>
                `;
            }
        }

        // Generate optimized simulated data with real DSE sectors and face values
        function generateSimulatedData() {
            const sectors = {
                'Bank': { faceValue: 10, peRange: [5, 15] },
                'Pharma': { faceValue: 10, peRange: [15, 30] },
                'Telecom': { faceValue: 10, peRange: [10, 25] },
                'Fuel & Power': { faceValue: 10, peRange: [8, 20] },
                'IT': { faceValue: 10, peRange: [20, 40] },
                'Food': { faceValue: 100, peRange: [10, 30] },
                'Insurance': { faceValue: 10, peRange: [5, 15] },
                'Textile': { faceValue: 10, peRange: [5, 12] },
                'Engineering': { faceValue: 10, peRange: [5, 15] },
                'Miscellaneous': { faceValue: 10, peRange: [5, 20] }
            };

            const stocks = [];
            const sampleStocks = [
                { ticker: 'GP', name: 'গ্রামীণফোন লিমিটেড', category: 'Telecom' },
                { ticker: 'SQURPHARMA', name: 'স্কয়ার ফার্মাসিউটিক্যালস', category: 'Pharma' },
                { ticker: 'BATBC', name: 'ব্রিটিশ আমেরিকান টোব্যাকো', category: 'Food' },
                { ticker: 'ACI', name: 'এসি আই লিমিটেড', category: 'Pharma' },
                { ticker: 'BEXIMCO', name: 'বেক্সিমকো লিমিটেড', category: 'Textile' },
                { ticker: 'RENATA', name: 'রেনাটা লিমিটেড', category: 'Pharma' },
                { ticker: 'ISLAMIBANK', name: 'ইসলামী ব্যাংক বাংলাদেশ', category: 'Bank' },
                { ticker: 'SUMITPOWER', name: 'সামিট পাওয়ার', category: 'Fuel & Power' },
                { ticker: 'LANKABAFIN', name: 'লাঙ্কাবাংলা ফাইন্যান্স', category: 'Bank' },
                { ticker: 'OLYMPIC', name: 'অলিম্পিক ইন্ডাস্ট্রিজ', category: 'Food' },
                { ticker: 'BDTHAI', name: 'বাংলাদেশ থাই অ্যালুমিনিয়াম', category: 'Engineering' },
                { ticker: 'SALVOCHEM', name: 'সালভো কেমিক্যাল', category: 'Miscellaneous' }
            ];

            sampleStocks.forEach((stock, index) => {
                const sectorInfo = sectors[stock.category] || sectors['Miscellaneous'];
                const peRange = sectorInfo.peRange;
                const peRatio = (Math.random() * (peRange[1] - peRange[0]) + peRange[0]).toFixed(2);
                const faceValue = sectorInfo.faceValue;
                const currentPrice = (Math.random() * 500 + 50).toFixed(2);
                const sharesOutstanding = Math.floor(Math.random() * 50 + 5) * 1000000; // 5M to 55M shares
                const marketCap = (currentPrice * sharesOutstanding / 10000000).toFixed(2); // In Crore BDT
                
                stocks.push({
                    ...stock,
                    faceValue: faceValue,
                    currentPrice: parseFloat(currentPrice),
                    marketCap: parseFloat(marketCap),
                    sharesOutstanding: sharesOutstanding,
                    revenueCAGR5Y: (Math.random() * 25 - 5).toFixed(2),
                    netProfitCAGR5Y: (Math.random() * 30 - 5).toFixed(2),
                    peRatio: parseFloat(peRatio),
                    pbRatio: (Math.random() * 5 + 0.5).toFixed(2),
                    roe: (Math.random() * 30 + 5).toFixed(2),
                    roce: (Math.random() * 35 + 5).toFixed(2),
                    debtToEquity: (Math.random() * 2).toFixed(2),
                    dividendYield: (Math.random() * 8).toFixed(2),
                    directorHoldings: (Math.random() * 80 + 10).toFixed(2),
                    totalScore: Math.floor(Math.random() * 100 + 50)
                });
            });

            return stocks;
        }

        // Initialize sector filter buttons
        function initSectorFilter() {
            const sectorContainer = document.getElementById('sectorFilter').querySelector('div');
            
            // Get all unique sectors
            const sectors = [...new Set(allStocks.map(stock => stock.category))];
            
            // Add sector buttons
            sectors.forEach(sector => {
                const btn = document.createElement('button');
                btn.className = 'sector-btn bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                btn.textContent = sector;
                btn.onclick = () => filterBySector(sector);
                sectorContainer.appendChild(btn);
            });
        }

        // Filter stocks by sector
        function filterBySector(sector) {
            currentSector = sector;
            
            // Update active button
            document.querySelectorAll('.sector-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-blue-100', 'text-blue-800');
            });
            
            if (sector === 'all') {
                filteredStocks = [...allStocks];
                document.querySelector('.sector-btn').classList.add('active', 'bg-blue-600', 'text-white');
            } else {
                filteredStocks = allStocks.filter(stock => stock.category === sector);
                document.querySelectorAll('.sector-btn').forEach(btn => {
                    if (btn.textContent === sector) {
                        btn.classList.add('active', 'bg-blue-600', 'text-white');
                        btn.classList.remove('bg-blue-100', 'text-blue-800');
                    }
                });
            }
            
            renderStockTable();
        }

        // Render the main stock table (optimized)
        function renderStockTable() {
            const tbody = document.getElementById('stockTableBody');
            if (!tbody) return;

            // Sort stocks
            const sortedStocks = [...filteredStocks].sort((a, b) => {
                const aVal = a[currentSort.key];
                const bVal = b[currentSort.key];
                
                if (aVal === undefined || bVal === undefined) return 0;
                if (currentSort.order === 'asc') return aVal - bVal;
                return bVal - aVal;
            });

            // Efficient DOM updates
            let html = '';
            
            sortedStocks.forEach(stock => {
                const peColor = stock.peRatio < 10 ? 'text-green-600' : stock.peRatio < 20 ? 'text-yellow-600' : 'text-red-600';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap font-medium">${stock.ticker}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${stock.category}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${stock.currentPrice.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${stock.faceValue}</td>
                        <td class="px-4 py-3 whitespace-nowrap">${stock.marketCap.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap ${peColor}">${stock.peRatio.toFixed(2)}</td>
                        <td class="px-4 py-3 whitespace-nowrap font-bold bg-blue-50">${stock.totalScore}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <button onclick="showStockDetail('${stock.ticker}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                বিশ্লেষণ দেখুন
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // Update sort indicators
            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
                if (th.getAttribute('onclick')?.includes(`sortTable('${currentSort.key}')`)) {
                    th.classList.add(currentSort.order === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        // Sort table by column
        function sortTable(key) {
            if (currentSort.key === key) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.key = key;
                currentSort.order = 'desc';
            }
            renderStockTable();
        }

        // Show detailed view for a stock
        function showStockDetail(ticker) {
            currentStock = allStocks.find(s => s.ticker === ticker);
            if (!currentStock) return;

            document.getElementById('tableView').classList.add('hidden');
            document.getElementById('detailView').classList.remove('hidden');
            document.getElementById('detailStockName').textContent = `${currentStock.ticker} - ${currentStock.name}`;

            // Update key metrics
            document.getElementById('keyMetrics').innerHTML = `
                <div class="flex justify-between">
                    <span class="text-gray-600">শ্রেণী:</span>
                    <span class="font-medium">${currentStock.category}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">বর্তমান মূল্য:</span>
                    <span class="font-medium">${currentStock.currentPrice.toFixed(2)} TK</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">ফেস ভ্যালু:</span>
                    <span class="font-medium">${currentStock.faceValue} TK</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">বাজার মূলধন:</span>
                    <span class="font-medium">${currentStock.marketCap.toFixed(2)} Crore</span>
                </div>
            `;

            // Update growth metrics
            document.getElementById('growthMetrics').innerHTML = `
                <div class="flex justify-between">
                    <span class="text-gray-600">রেভিনিউ CAGR 5Y:</span>
                    <span class="font-medium ${currentStock.revenueCAGR5Y > 10 ? 'text-green-600' : 'text-red-600'}">${currentStock.revenueCAGR5Y}%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">নেট লাভ CAGR 5Y:</span>
                    <span class="font-medium ${currentStock.netProfitCAGR5Y > 10 ? 'text-green-600' : 'text-red-600'}">${currentStock.netProfitCAGR5Y}%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">ROE:</span>
                    <span class="font-medium">${currentStock.roe}%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">ROCE:</span>
                    <span class="font-medium">${currentStock.roce}%</span>
                </div>
            `;

            // Update valuation metrics
            document.getElementById('valuationMetrics').innerHTML = `
                <div class="flex justify-between">
                    <span class="text-gray-600">P/E Ratio:</span>
                    <span class="font-medium ${currentStock.peRatio < 15 ? 'text-green-600' : 'text-red-600'}">${currentStock.peRatio.toFixed(2)}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">P/B Ratio:</span>
                    <span class="font-medium">${currentStock.pbRatio}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">মূল্য/ফেস ভ্যালু:</span>
                    <span class="font-medium">${(currentStock.currentPrice / currentStock.faceValue).toFixed(2)}x</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">ডিভিডেন্ড ফলন:</span>
                    <span class="font-medium">${currentStock.dividendYield}%</span>
                </div>
            `;

            // Update TradingView link
            document.getElementById('tradingviewLink').href = `https://www.tradingview.com/chart/?symbol=DHAKA:${currentStock.ticker}`;
            
            // Update analysis summary
            updateAnalysisSummary();
        }

        // Update analysis summary in Bangla
        function updateAnalysisSummary() {
            let summary = '';
            
            // Valuation analysis
            const sectorPE = getSectorAveragePE(currentStock.category);
            if (currentStock.peRatio < sectorPE * 0.7) {
                summary += `<p class="mb-2">এই স্টকটি ${currentStock.category} সেক্টরের গড় P/E (${sectorPE.toFixed(2)}) এর তুলনায় কম মূল্যায়নে (${currentStock.peRatio.toFixed(2)}) লেনদেন হচ্ছে।</p>`;
            } else if (currentStock.peRatio > sectorPE * 1.3) {
                summary += `<p class="mb-2 text-red-600">সতর্কতা: এই স্টকটি ${currentStock.category} সেক্টরের গড় P/E (${sectorPE.toFixed(2)}) এর তুলনায় বেশি মূল্যায়নে (${currentStock.peRatio.toFixed(2)}) লেনদেন হচ্ছে।</p>`;
            } else {
                summary += `<p class="mb-2">এই স্টকটি ${currentStock.category} সেক্টরের গড় P/E (${sectorPE.toFixed(2)}) এর কাছাকাছি মূল্যায়নে (${currentStock.peRatio.toFixed(2)}) লেনদেন হচ্ছে।</p>`;
            }
            
            // Growth analysis
            if (currentStock.revenueCAGR5Y > 15 && currentStock.netProfitCAGR5Y > 15) {
                summary += `<p class="mb-2">কোম্পানিটির আয় ও মুনাফা উভয়ই শক্তিশালী হারে (${currentStock.revenueCAGR5Y}% ও ${currentStock.netProfitCAGR5Y}%) বৃদ্ধি পাচ্ছে।</p>`;
            } else if (currentStock.netProfitCAGR5Y > currentStock.revenueCAGR5Y) {
                summary += `<p class="mb-2">মুনাফার বৃদ্ধি (${currentStock.netProfitCAGR5Y}%) আয়ের বৃদ্ধি (${currentStock.revenueCAGR5Y}%) কে ছাড়িয়ে গেছে, যা দক্ষতা বৃদ্ধি নির্দেশ করে।</p>`;
            }
            
            // Face value analysis
            const priceToFaceValue = (currentStock.currentPrice / currentStock.faceValue).toFixed(2);
            if (priceToFaceValue > 10) {
                summary += `<p class="mb-2">স্টকটি ফেস ভ্যালুর ${priceToFaceValue}x মূল্যে লেনদেন হচ্ছে, যা উচ্চ মূল্যায়ন নির্দেশ করতে পারে।</p>`;
            } else if (priceToFaceValue < 3) {
                summary += `<p class="mb-2">স্টকটি ফেস ভ্যালুর ${priceToFaceValue}x মূল্যে লেনদেন হচ্ছে, যা আকর্ষণীয় মূল্যায়ন নির্দেশ করে।</p>`;
            }
            
            // Final recommendation
            if (currentStock.totalScore > 120) {
                summary += `<p class="mt-4 font-medium text-green-600">সুপারিশ: এই স্টকটি আমাদের স্ক্রিনারে উচ্চ স্কোর (${currentStock.totalScore}) পেয়েছে এবং দীর্ঘমেয়াদী বিনিয়োগের জন্য উপযুক্ত বলে বিবেচিত হয়েছে।</p>`;
            } else if (currentStock.totalScore > 80) {
                summary += `<p class="mt-4 font-medium text-yellow-600">সুপারিশ: এই স্টকটি মাঝারি স্কোর (${currentStock.totalScore}) পেয়েছে। বিনিয়োগের পূর্বে আরও বিশ্লেষণ প্রয়োজন।</p>`;
            } else {
                summary += `<p class="mt-4 font-medium text-red-600">সতর্কতা: এই স্টকটি নিম্ন স্কোর (${currentStock.totalScore}) পেয়েছে। বিনিয়োগে সতর্কতা অবলম্বন করুন।</p>`;
            }
            
            document.getElementById('analysisSummary').innerHTML = summary;
        }

        // Get sector average PE
        function getSectorAveragePE(sector) {
            const sectorStocks = allStocks.filter(stock => stock.category === sector);
            if (sectorStocks.length === 0) return 15; // Default average
            
            const totalPE = sectorStocks.reduce((sum, stock) => sum + stock.peRatio, 0);
            return totalPE / sectorStocks.length;
        }

        // Show the table view
        function showTableView() {
            document.getElementById('tableView').classList.remove('hidden');
            document.getElementById('detailView').classList.add('hidden');
        }

        // Update the last updated time
        function updateLastUpdatedTime() {
            const now = new Date();
            document.getElementById('updateTime').textContent = now.toLocaleTimeString();
        }
    </script>
</body>
</html>
